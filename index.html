<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Logo Weight Balancer</title>
<style>
  body   {font-family:sans-serif;max-width:46rem;margin:auto;padding:1.5rem;}
  h2     {margin-top:0}
  label  {display:block;margin:.5rem 0;}
  input  {padding:.25rem;}
  .dropzone {border:2px dashed #999;border-radius:.5rem;text-align:center;
             padding:2rem;margin:1rem 0;min-height:120px;transition:.2s border-color}
  .dropzone.hover{border-color:#007bff}
  .preview {display:block;margin:auto;}
  table  {width:100%;border-collapse:collapse;margin-top:1.5rem}
  th,td  {border-bottom:1px solid #ddd;padding:.4rem .5rem;text-align:left;vertical-align:middle}
  th     {background:#fafafa}
  #baseline-info{margin:.5rem 0 1rem;font-weight:bold}
</style>
</head>
<body>
<h2>Logo Weight Balancer <small>(drag images in)</small></h2>

<label>Standard height for all logos (px)
  <input id="baseHeightInput" type="number" value="40" min="1">
</label>

<div id="baseline-zone" class="dropzone">
  <strong>Drop baseline (darkest) logo here</strong><br>
  <em>…or click and choose</em>
</div>
<p id="baseline-info">Baseline not set.</p>

<div id="other-zone" class="dropzone">
  <strong>Drop other logo(s) here</strong><br>
  <em>…or click and choose</em>
</div>

<table id="results" style="display:none">
  <thead>
    <tr>
      <th>Logo preview</th>
      <th>Brightness&nbsp;%</th>
      <th>Scale&nbsp;%</th>
      <th>Final&nbsp;W&nbsp;×&nbsp;H&nbsp;(px)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let baseline = null;   // {w, h, brightness}

/* ----------  helpers  ---------- */
function averageBrightness(img, scale = 1) {
  const w = Math.round(img.width * scale);
  const h = Math.round(img.height * scale);
  const canvas = Object.assign(document.createElement('canvas'), {width: w, height: h});
  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0, w, h);
  const {data} = ctx.getImageData(0, 0, w, h);

  let sum = 0;
  for (let i = 0; i < data.length; i += 4) {
    const alpha = data[i + 3];
    sum += (alpha === 0 ? 255*3 : data[i] + data[i+1] + data[i+2]);
  }
  return (sum / (3 * w * h) / 255) * 100;   // brightness %
}

function handleFiles(files, isBaseline) {
  [...files].forEach(file => {
    if (!file.type.startsWith('image/')) return;
    const img = new Image();
    img.onload = () => isBaseline ? setBaseline(img, file) : processLogo(img, file);
    img.src = URL.createObjectURL(file);
  });
}

/* ----------  baseline  ---------- */
function setBaseline(img, file) {
  const targetH = +document.getElementById('baseHeightInput').value || 40;
  const scale   = targetH / img.height;

  baseline = {
    w: img.width * scale,
    h: targetH,
    brightness: averageBrightness(img, scale)
  };

  // show preview inside the drop-zone
  const zone = document.getElementById('baseline-zone');
  zone.innerHTML = `<img class="preview" src="${img.src}" style="height:${targetH}px">`;

  document.getElementById('baseline-info').textContent =
    `Baseline: ${file.name} – ${Math.round(baseline.w)} × ${baseline.h}px, ` +
    `brightness ${baseline.brightness.toFixed(2)} %`;

  // clear previous results
  const tbody = document.querySelector('#results tbody');
  tbody.innerHTML = '';
  document.getElementById('results').style.display = 'none';
}

/* ----------  other logos  ---------- */
function processLogo(img, file) {
  if (!baseline) { alert('Drop a baseline logo first.'); return; }

  const targetH = baseline.h;                        // common height
  const scaleToH = targetH / img.height;
  const scaledW  = img.width * scaleToH;
  const brightness = averageBrightness(img, scaleToH);

  const areaBase = baseline.w * baseline.h;
  const areaLogo = scaledW   * targetH;

  const s = Math.sqrt((1 - baseline.brightness/100) * areaBase /
                      ((1 - brightness/100)          * areaLogo));

  const finalW = Math.round(scaledW * s);
  const finalH = (targetH * s).toFixed(1);

  addRow(img.src, brightness, s, finalW, finalH);
}

function addRow(src, bright, scale, w, h) {
  const tbody = document.querySelector('#results tbody');
  const row = tbody.insertRow();
  row.innerHTML =
    `<td><img src="${src}" style="height:${h}px"></td>` +
    `<td>${bright.toFixed(2)}</td>` +
    `<td>${(scale*100).toFixed(1)}</td>` +
    `<td>${w} × ${h}</td>`;
  document.getElementById('results').style.display = '';
}

/* ----------  drag-and-drop plumbing  ---------- */
function setupDropzone(id, isBaseline) {
  const zone = document.getElementById(id);

  ['dragenter','dragover'].forEach(evt =>
    zone.addEventListener(evt, e => { e.preventDefault(); zone.classList.add('hover'); })
  );
  ['dragleave','drop'].forEach(evt =>
    zone.addEventListener(evt, e => { e.preventDefault(); zone.classList.remove('hover'); })
  );
  zone.addEventListener('drop', e => handleFiles(e.dataTransfer.files, isBaseline));

  // click-to-open fallback
  zone.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    if (!isBaseline) input.multiple = true;
    input.accept = 'image/*';
    input.onchange = () => handleFiles(input.files, isBaseline);
    input.click();
  });
}

setupDropzone('baseline-zone', true);
setupDropzone('other-zone',     false);
</script>
</body>
</html>